<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Professional web-based serial monitor for embedded systems — real-time terminal, plotter, protocol decoders, and macros.">
    <title>Serial Monitor — Professional Embedded Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- ═══════════════ HEADER ═══════════════ -->
    <header id="app-header">
        <div class="header-left">
            <div class="logo">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
                    <rect x="2" y="4" width="24" height="20" rx="3" stroke="currentColor" stroke-width="2" />
                    <path d="M7 14h4l2-4 2 8 2-4h4" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <h1>Serial Monitor</h1>
            </div>
        </div>
        <div class="header-right">
            <div id="connection-badge" class="badge badge-disconnected">
                <span class="pulse-dot"></span>
                <span id="connection-label">Disconnected</span>
            </div>
            <button class="icon-btn" id="btn-profiles" title="Profiles & Presets">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
            </button>
            <button class="icon-btn" id="btn-macros" title="Command Macros">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 17l6-6-6-6M12 19h8" />
                </svg>
            </button>
            <button class="icon-btn" id="btn-export" title="Export Logs">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
                </svg>
            </button>
            <button class="icon-btn" id="btn-theme" title="Toggle Theme">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
            </button>
        </div>
    </header>

    <!-- ═══════════════ TAB BAR ═══════════════ -->
    <div id="tab-bar" class="tab-bar">
        <div id="tab-list" class="tab-list">
            <!-- Tabs are dynamically added here -->
        </div>
        <button id="btn-new-tab" class="tab-new-btn" title="Open new serial monitor (Ctrl+T)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M12 5v14M5 12h14" />
            </svg>
        </button>
    </div>

    <!-- ═══════════════ MAIN LAYOUT ═══════════════ -->
    <main id="app-main">
        <!-- ────── LEFT SIDEBAR: Connection Settings ────── -->
        <aside id="sidebar" class="panel sidebar-panel">
            <div class="panel-header">
                <h2>Connection</h2>
            </div>
            <div class="panel-body sidebar-body">
                <!-- Port -->
                <div class="form-group">
                    <label for="port-select">Port</label>
                    <div class="input-with-btn">
                        <select id="port-select" class="input">
                            <option value="">— Select Port —</option>
                        </select>
                        <button class="icon-btn-sm" id="btn-refresh-ports" title="Refresh Ports">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M23 4v6h-6M1 20v-6h6" />
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Baud Rate -->
                <div class="form-group">
                    <label for="baud-rate">Baud Rate</label>
                    <select id="baud-rate" class="input">
                        <option value="110">110</option>
                        <option value="300">300</option>
                        <option value="600">600</option>
                        <option value="1200">1200</option>
                        <option value="2400">2400</option>
                        <option value="4800">4800</option>
                        <option value="9600">9600</option>
                        <option value="14400">14400</option>
                        <option value="19200">19200</option>
                        <option value="28800">28800</option>
                        <option value="38400">38400</option>
                        <option value="57600">57600</option>
                        <option value="76800">76800</option>
                        <option value="115200" selected>115200</option>
                        <option value="230400">230400</option>
                        <option value="250000">250000</option>
                        <option value="460800">460800</option>
                        <option value="500000">500000</option>
                        <option value="921600">921600</option>
                        <option value="1000000">1000000</option>
                        <option value="custom">Custom...</option>
                    </select>
                    <input type="number" id="baud-custom" class="input" placeholder="Custom baud" style="display:none;"
                        min="1">
                </div>
                <!-- Data / Parity / Stop row -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="data-bits">Data</label>
                        <select id="data-bits" class="input">
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8" selected>8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="parity">Parity</label>
                        <select id="parity" class="input">
                            <option value="none" selected>None</option>
                            <option value="even">Even</option>
                            <option value="odd">Odd</option>
                            <option value="mark">Mark</option>
                            <option value="space">Space</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="stop-bits">Stop</label>
                        <select id="stop-bits" class="input">
                            <option value="1" selected>1</option>
                            <option value="1.5">1.5</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="flow-control">Flow</label>
                        <select id="flow-control" class="input">
                            <option value="none" selected>None</option>
                            <option value="rtscts">RTS/CTS</option>
                            <option value="xon/xoff">XON/XOFF</option>
                        </select>
                    </div>
                </div>
                <!-- Decoder -->
                <div class="form-group">
                    <label for="decoder-select">Protocol Decoder</label>
                    <select id="decoder-select" class="input">
                        <option value="">None</option>
                    </select>
                </div>
                <!-- Connect / Disconnect -->
                <div class="sidebar-connect-actions">
                    <button id="btn-connect" class="btn btn-primary btn-full">Connect</button>
                    <button id="btn-disconnect" class="btn btn-danger btn-full"
                        style="display:none;">Disconnect</button>
                </div>
            </div>
        </aside>

        <!-- ────── CENTER: Terminal + Plotter ────── -->
        <section id="center-panel">
            <!-- Search Bar -->
            <div id="search-bar" class="search-bar">
                <div class="search-input-wrap">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8" />
                        <path d="M21 21l-4.35-4.35" />
                    </svg>
                    <input type="text" id="search-input" class="input" placeholder="Search logs... (supports regex)">
                    <label class="toggle-small" title="Regex mode">
                        <input type="checkbox" id="search-regex">
                        <span>.*</span>
                    </label>
                </div>
                <div class="search-nav">
                    <span id="search-count">0 matches</span>
                    <button class="icon-btn-sm" id="search-prev" title="Previous match">▲</button>
                    <button class="icon-btn-sm" id="search-next" title="Next match">▼</button>
                    <button class="icon-btn-sm" id="search-clear" title="Clear search">✕</button>
                </div>
            </div>

            <!-- Terminal -->
            <div id="terminal-container" class="terminal-container">
                <div class="terminal-toolbar">
                    <span class="terminal-title">Terminal</span>
                    <div class="terminal-actions">
                        <label class="toggle-small" title="Auto-scroll">
                            <input type="checkbox" id="terminal-autoscroll" checked>
                            <span>Auto-scroll</span>
                        </label>
                        <label class="toggle-small" title="Show timestamps">
                            <input type="checkbox" id="terminal-timestamps" checked>
                            <span>Timestamps</span>
                        </label>
                        <button class="icon-btn-sm" id="btn-clear-terminal" title="Clear terminal">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                            </svg>
                        </button>
                        <span id="terminal-line-count" class="terminal-line-count">0 lines</span>
                    </div>
                </div>
                <div id="terminal" class="terminal" role="log" aria-live="polite"></div>
            </div>

            <!-- Plotter (Collapsible) -->
            <div id="plotter-collapse-header" class="collapsible-header collapsed">
                <svg class="collapse-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9" />
                </svg>
                <span class="collapsible-title">Plotter</span>
                <div class="plotter-actions" id="plotter-header-actions">
                    <label class="toggle-small" title="Auto-scale Y axis">
                        <input type="checkbox" id="plotter-autoscale" checked>
                        <span>Auto-scale</span>
                    </label>
                    <button class="icon-btn-sm" id="btn-plotter-pause" title="Pause/Resume">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="6" y="4" width="4" height="16" />
                            <rect x="14" y="4" width="4" height="16" />
                        </svg>
                    </button>
                    <button class="icon-btn-sm" id="btn-plotter-clear" title="Clear plot">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="plotter-container" class="plotter-container collapsed">
                <div class="plotter-legend" id="plotter-legend"></div>
                <canvas id="plotter-canvas"></canvas>
                <div class="plotter-cursor" id="plotter-cursor"></div>
            </div>
        </section>

        <!-- ────── RIGHT SIDEBAR: Stats + Protocol (Collapsible) ────── -->
        <aside id="right-sidebar" class="panel right-sidebar-panel">
            <div class="panel-header collapsible-sidebar-header" id="stats-collapse-header">
                <div class="panel-header-left">
                    <svg class="collapse-chevron-h" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <polyline points="9 6 15 12 9 18" />
                    </svg>
                    <h2>Statistics</h2>
                </div>
            </div>
            <div class="panel-body" id="stats-panel-body">
                <!-- Live Throughput -->
                <div class="stat-section-label">Live Throughput</div>
                <div class="stat-grid">
                    <div class="stat-card stat-card-accent">
                        <span class="stat-label">RX Rate</span>
                        <span class="stat-value" id="throughput-rx">0 B/s</span>
                    </div>
                    <div class="stat-card stat-card-accent">
                        <span class="stat-label">TX Rate</span>
                        <span class="stat-value" id="throughput-tx">0 B/s</span>
                    </div>
                </div>

                <div class="stat-section-label">Totals</div>
                <div class="stat-grid">
                    <div class="stat-card">
                        <span class="stat-label">Bytes RX</span>
                        <span class="stat-value" id="stat-bytes-rx">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Bytes TX</span>
                        <span class="stat-value" id="stat-bytes-tx">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Lines RX</span>
                        <span class="stat-value" id="stat-lines-rx">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Lines TX</span>
                        <span class="stat-value" id="stat-lines-tx">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Errors</span>
                        <span class="stat-value stat-error" id="stat-errors">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Uptime</span>
                        <span class="stat-value" id="stat-uptime">—</span>
                    </div>
                </div>

                <hr class="divider">
                <h3 class="section-title">Protocol Decoder</h3>
                <div id="protocol-viewer" class="protocol-viewer">
                    <p class="muted">No decoder active</p>
                </div>
            </div>
        </aside>
    </main>

    <!-- ═══════════════ SEND BAR ═══════════════ -->
    <footer id="send-bar" class="send-bar">
        <div class="send-mode-group">
            <label class="radio-pill">
                <input type="radio" name="send-mode" value="ascii" checked>
                <span>ASCII</span>
            </label>
            <label class="radio-pill">
                <input type="radio" name="send-mode" value="hex">
                <span>HEX</span>
            </label>
            <label class="radio-pill">
                <input type="radio" name="send-mode" value="binary">
                <span>BIN</span>
            </label>
        </div>
        <div class="send-input-wrap">
            <input type="text" id="send-input" class="input send-input" placeholder="Enter command...">
            <button id="btn-send" class="btn btn-accent" title="Send (Enter)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                </svg>
                Send
            </button>
        </div>
        <div class="send-options">
            <label class="toggle-small" title="Repeat send">
                <input type="checkbox" id="send-repeat">
                <span>Repeat</span>
            </label>
            <input type="number" id="send-repeat-interval" class="input input-tiny" value="1000" min="50"
                placeholder="ms" title="Repeat interval (ms)" style="display:none;">
            <button id="btn-send-pause" class="icon-btn-sm" title="Pause/Resume repeat" style="display:none;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="4" width="4" height="16" />
                    <rect x="14" y="4" width="4" height="16" />
                </svg>
            </button>
        </div>
    </footer>

    <!-- ═══════════════ MODALS ═══════════════ -->
    <!-- Export Modal -->
    <div id="modal-export" class="modal-overlay" style="display:none;">
        <div class="modal">
            <div class="modal-header">
                <h2>Export Logs</h2>
                <button class="icon-btn-sm modal-close" data-modal="modal-export">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Format</label>
                    <div class="radio-group">
                        <label class="radio-pill"><input type="radio" name="export-format" value="txt"
                                checked><span>.txt</span></label>
                        <label class="radio-pill"><input type="radio" name="export-format"
                                value="csv"><span>.csv</span></label>
                        <label class="radio-pill"><input type="radio" name="export-format"
                                value="json"><span>.json</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="export-filter">Filter (regex or text)</label>
                    <input type="text" id="export-filter" class="input" placeholder="Optional filter...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline modal-close" data-modal="modal-export">Cancel</button>
                <button class="btn btn-primary" id="btn-do-export">Export</button>
            </div>
        </div>
    </div>

    <!-- Macros Modal -->
    <div id="modal-macros" class="modal-overlay" style="display:none;">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2>Command Macros</h2>
                <button class="icon-btn-sm modal-close" data-modal="modal-macros">✕</button>
            </div>
            <div class="modal-body">
                <div id="macro-list" class="macro-list">
                    <p class="muted">No macros saved yet.</p>
                </div>
                <hr class="divider">
                <h3 class="section-title">New Macro</h3>
                <div class="form-group">
                    <label for="macro-name">Name</label>
                    <input type="text" id="macro-name" class="input" placeholder="Macro name">
                </div>
                <div class="form-group">
                    <label for="macro-commands">Commands (one per line, format: data|mode|delayMs)</label>
                    <textarea id="macro-commands" class="input textarea" rows="4"
                        placeholder="AT+RST|ascii|500&#10;AT+CWJAP=...|ascii|1000"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="macro-repeat">Repeat Count</label>
                        <input type="number" id="macro-repeat" class="input" value="1" min="1">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline modal-close" data-modal="modal-macros">Cancel</button>
                <button class="btn btn-primary" id="btn-save-macro">Save Macro</button>
            </div>
        </div>
    </div>

    <!-- Profiles Modal -->
    <div id="modal-profiles" class="modal-overlay" style="display:none;">
        <div class="modal">
            <div class="modal-header">
                <h2>Profiles & Presets</h2>
                <button class="icon-btn-sm modal-close" data-modal="modal-profiles">✕</button>
            </div>
            <div class="modal-body">
                <div id="profile-list" class="macro-list">
                    <p class="muted">No profiles saved yet.</p>
                </div>
                <hr class="divider">
                <div class="form-group">
                    <label for="profile-name">Save Current Config As</label>
                    <input type="text" id="profile-name" class="input" placeholder="Profile name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline modal-close" data-modal="modal-profiles">Cancel</button>
                <button class="btn btn-primary" id="btn-save-profile">Save Profile</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/theme.js"></script>
    <script src="js/terminal.js"></script>
    <script src="js/plotter.js"></script>
    <script src="js/search.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/macros.js"></script>
    <script src="js/export.js"></script>
    <script src="js/profiles.js"></script>
    <script src="js/protocol-viewer.js"></script>
    <script src="js/app.js"></script>
</body>

</html>